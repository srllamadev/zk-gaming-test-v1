# ZK Roulette for Streamers
### Stellar ZK Gaming Hackathon 2026 · Provable Randomness

> **Zero-Knowledge Commit-Reveal for 100% fair and verifiable live giveaways.**
> No streamer can manipulate the result, and anyone can audit it.

---

## Stack

| Layer | Technology |
|-------|------------|
| ZK Circuit | Noir `>= 0.36.0` + Poseidon BN254 |
| Smart Contract | Soroban / Rust (`soroban-sdk 22`) |
| Frontend | HTML + CSS + Vanilla JS (no frameworks) |
| Wallet | Freighter (`@stellar/freighter-api`) |
| Network | Stellar Testnet · Protocol 25 (X-Ray) |

## Project Structure

```
zk-project/
├── circuits/                  # Noir ZK circuit
│   ├── Nargo.toml
│   ├── Prover.toml            # Example values (dev only)
│   ├── README.md
│   └── src/
│       └── main.nr            # ZK commit-reveal logic
├── contract/                  # Soroban contract
│   ├── Cargo.toml
│   └── src/
│       └── lib.rs             # commit_draw / register / reveal_winner
├── frontend/
│   └── index.html             # Cosmic UI · all JS logic (Spanish)
├── index.html                 # English version (GitHub Pages)
├── scripts/
│   └── deploy.sh              # Automated deploy to Testnet
├── Cargo.toml                 # Rust workspace
└── README.md
```

## Quick Start

### 1. Noir Circuit

```bash
# Install Noir
curl -L https://raw.githubusercontent.com/noir-lang/noirup/main/install | bash
noirup

# Compile and test
cd circuits
nargo compile
nargo test

# Generate a sample proof (requires updating Prover.toml first)
nargo prove && nargo verify
```

### 2. Soroban Contract

```bash
# Requirements: Rust + wasm32-unknown-unknown target + Stellar CLI
rustup target add wasm32-unknown-unknown
cargo install --locked stellar-cli --features opt

# Build
cargo build --target wasm32-unknown-unknown --release -p zk-roulette

# Tests
cargo test -p zk-roulette

# Full deploy to Testnet (generates .env with CONTRACT_ID)
chmod +x scripts/deploy.sh
./scripts/deploy.sh my-account
```

### 3. Frontend

```bash
# Open in browser (no build tools required)
# 1. Copy CONTRACT_ID from the .env generated by deploy.sh
# 2. Edit index.html → const CONFIG = { CONTRACT_ID: "..." }
# 3. Install Freighter: https://freighter.app
open index.html
```

---

## ZK Commit-Reveal Flow

```
STREAMER                          SOROBAN CONTRACT              PARTICIPANTS
    │                                    │                            │
    │── 1. Generate secret + salt ───────┤                            │
    │   locally (Web Crypto API)         │                            │
    │                                    │                            │
    │── 2. commit_draw(SHA-256(s|salt)) ─►  Stores commitment         │
    │                                    │  on-chain                  │
    │                                    │                            │
    │                                    │◄── 3. register_participant ──│
    │                                    │    (viewers)               │
    │                                    │                            │
    │── 4. close_registrations() ────────►  Freezes participant list  │
    │                                    │                            │
    │── 5. reveal_winner(secret, salt) ──►  Verifies:                 │
    │   + Noir ZK Proof generated        │  SHA256(s|salt)==commitment │
    │                                    │  winner = s % n            │
    │                                    │  start_game() + end_game() │
    │                                    │  on Game Hub               │
    │                                    │                            │
    │◄───── Event: winner_revealed ──────┤                            │
```

## Security Guarantees

| Property | Mechanism | Guarantee |
|----------|-----------|----------|
| **Binding** | SHA-256 stored on-chain before registration | Streamer cannot change the secret |
| **Hiding** | Random 32-byte salt | Secret cannot be derived from the hash |
| **Fairness** | `winner = secret % participants` | Uniform distribution |
| **Verifiability** | Noir circuit → UltraPlonk proof | Anyone can verify the proof |
| **No-trust** | Commitment published before closing | Organizer does not know participants when committing |

## Game Hub Integration

The contract calls `start_game()` and `end_game()` on:

```
CB4VZAT2U3UC6XFK3N23SKRF2NDCMP3QHJYMCHHFMZO7MRQO6DQ2EMYG
```

- `player1` = streamer (organizer)
- `player2` = winner (determined by ZK reveal)
- `end_game(player1_won: false)` → the winner (player2) is the prize recipient

## Production Noir.js Integration

To enable real in-browser proof generation, replace the `simulateNoirProof`
function in `index.html` with:

```js
import { Noir }                from '@noir-lang/noir_js';
import { BarretenbergBackend } from '@noir-lang/backend_barretenberg';
import circuit                 from './circuits/target/zk_roulette.json';

const backend = new BarretenbergBackend(circuit);
const noir    = new Noir(circuit, backend);

const { proof, publicInputs } = await noir.generateProof({
  secret_number:          secretNumber.toString(),
  salt:                   poseidonFieldFromBytes(salt),   // BN254 Field element
  public_commitment:      poseidonHash(secretNumber, salt),
  number_of_participants: numParticipants,
});
```

> Note: The Soroban contract verifies the commitment using SHA-256 (available
> directly via `env.crypto()`). The Noir proof uses Poseidon for the formal
> off-chain proof. In production both hashes are unified using
> `env.crypto().poseidon2_hash()` from Protocol 25.

---

*Built for the Stellar ZK Gaming Hackathon 2026 · MIT License*
