<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Z-Spin â€” Stellar Hackathon 2026</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/@stellar/stellar-sdk@13/dist/stellar-sdk.min.js"></script>
</head>
<body>

<div id="winner-overlay">
  <div class="w-card">
    <div class="w-trophy">ğŸ†</div>
    <div class="w-sub">Draw verified with ZK Proof Â· Stellar Protocol 25</div>
    <div id="w-addr" class="w-addr">â€”</div>
    <div id="w-prize" class="w-prize"></div>
    <div id="w-badge" class="w-badge">Entry #â€”</div>
    <button class="btn btn-ghost" style="margin-top:12px" onclick="closeWinnerOverlay()">Close</button>
  </div>
</div>

<div id="app">

  <header>
    <div class="logo">
      <div class="logo-icon">ğŸ°</div>
      <div class="logo-text">
        <h1>Z-Spin</h1>
        <p>Provable Randomness Â· Stellar Hackathon 2026</p>
      </div>
    </div>
    <div class="header-right">
      <div class="badge"><div class="dot-live"></div> Testnet</div>
      <button id="wallet-btn" onclick="connectWallet()">
        <div class="wallet-dot" id="wallet-dot"></div>
        <span id="wallet-label">Connect Freighter</span>
      </button>
    </div>
  </header>

  <div class="phase-bar">
    <div class="phase-step active" id="phase-0">â‘  Setup</div>
    <div class="phase-step" id="phase-1">â‘¡ Commit</div>
    <div class="phase-step" id="phase-2">â‘¢ Register</div>
    <div class="phase-step" id="phase-3">â‘£ Close</div>
    <div class="phase-step" id="phase-4">â‘¤ Reveal</div>
  </div>

  <div class="stats-row">
    <div class="stat">
      <div class="stat-val" id="stat-participants">0</div>
      <div class="stat-lbl">Participants</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-winners">â€”</div>
      <div class="stat-lbl">Winners</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-prize">â€”</div>
      <div class="stat-lbl">Prize (XLM)</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-phase">SETUP</div>
      <div class="stat-lbl">Phase</div>
    </div>
  </div>

  <div class="bento">

    <div class="bcard span-2" id="bcard-setup">
      <div class="bcard-title"><span class="icon">âš™ï¸</span> Draw Setup</div>
      <div class="title-line"></div>
      <div class="setup-flow">

        <div class="step-card active-step" id="step-a">
          <div class="step-header">
            <span class="step-num">1</span>
            <span class="icon">ğŸ‘¥</span> Number of Participants
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>How many people will enter the draw?</label>
              <input type="number" id="input-participants-count" placeholder="e.g. 10" min="2" max="500" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmParticipantsCount()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>

        <div class="step-card" id="step-b" style="opacity:.45;pointer-events:none">
          <div class="step-header">
            <span class="step-num">2</span>
            <span class="icon">ğŸ’°</span> Prize Amount
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>Total XLM to distribute among winners</label>
              <input type="number" id="input-prize-amount" placeholder="e.g. 100" min="0.0000001" step="any" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmPrize()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>

        <div class="step-card" id="step-c" style="opacity:.45;pointer-events:none">
          <div class="step-header">
            <span class="step-num">3</span>
            <span class="icon">ğŸ†</span> Number of Winners
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>How many winners?</label>
              <input type="number" id="input-winners-count" placeholder="e.g. 1" min="1" max="50" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmWinners()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>

      </div>
    </div>

    <div class="bcard span-2" id="bcard-wallets" style="display:none">
      <div class="bcard-title"><span class="icon">ğŸŸï¸</span> Participant Wallets</div>
      <div class="title-line"></div>

      <div class="wallet-progress">
        <span id="wallet-progress-label">0 / <span id="wallet-total-label">0</span> registered</span>
        <div class="wallet-progress-bar">
          <div class="wallet-progress-fill" id="wallet-progress-fill" style="width:0%"></div>
        </div>
      </div>

      <div id="wallet-inputs-section">
        <div class="wallet-row">
          <input type="text" id="input-participant" placeholder="G... Stellar address" />
          <button class="btn btn-primary" onclick="doRegister()" style="width:auto;padding:10px 20px">
            <span id="btn-register-spinner"></span> Add
          </button>
        </div>
        <p class="text-muted" style="margin-bottom:12px;font-size:.76rem">
          Enter each participant'''s Stellar wallet address (G..., 56 chars).
        </p>
      </div>

      <div id="participants-grid">
        <p class="text-muted" style="text-align:center;padding:16px 0">No participants yet.</p>
      </div>

      <div class="divider"></div>

      <div id="wallet-actions" style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-primary" id="btn-commit-main" onclick="doCommit()" style="flex:1">
          <span id="btn-commit-spinner"></span> ğŸ”’ Publish Commitment
        </button>
        <button class="btn btn-ghost" id="btn-close-main" onclick="doCloseRegistrations()" style="flex:1" disabled>
          <span id="btn-close-spinner"></span> ğŸ” Close Registrations
        </button>
      </div>
    </div>

    <div class="bcard span-row-2" style="grid-column:3;grid-row:1/3;display:flex;flex-direction:column;align-items:center;gap:20px;justify-content:center">
      <div class="bcard-title" style="width:100%"><span class="icon">ğŸ¡</span> Wheel</div>
      <div class="roulette-wrap">
        <div class="roulette-outer">
          <div class="roulette-pointer">â–¼</div>
          <canvas id="roulette-canvas" width="240" height="240"></canvas>
        </div>
        <button id="spin-btn" class="btn btn-gold" onclick="spinRoulette()" disabled>
          ğŸ° Spin &amp; Reveal
        </button>
      </div>
      <div style="width:100%">
        <div class="input-group" style="margin-bottom:8px">
          <label>Session ID</label>
          <input type="number" id="input-session-id" placeholder="e.g. 1001" min="1" max="999999" />
        </div>
      </div>
    </div>

    <div class="bcard">
      <div class="bcard-title"><span class="icon">ğŸ§®</span> ZK Commit-Reveal</div>
      <div class="title-line"></div>
      <div class="zk-box">
        <div class="zk-row"><span class="zk-lbl">Secret</span><span class="zk-val dim" id="zk-secret">hidden</span></div>
        <div class="zk-row"><span class="zk-lbl">Salt</span><span class="zk-val dim" id="zk-salt">hidden</span></div>
        <div class="zk-row"><span class="zk-lbl">Commitment</span><span class="zk-val dim" id="zk-commitment">â€”</span></div>
        <div class="zk-row"><span class="zk-lbl">On-chain</span><span class="zk-val dim" id="zk-onchain">pending</span></div>
        <div class="zk-row"><span class="zk-lbl">Entries</span><span class="zk-val dim" id="zk-participants">0</span></div>
        <div class="zk-row"><span class="zk-lbl">winner_index</span><span class="zk-val dim" id="zk-winner">â€”</span></div>
        <div class="zk-row"><span class="zk-lbl">Noir Proof</span><span class="zk-val dim" id="zk-proof-status">pending</span></div>
      </div>
      <div style="margin-top:10px">
        <a id="noir-proof-link" href="#" style="display:none;font-size:.75rem;color:var(--pink)">View proof JSON â†’</a>
      </div>
    </div>

    <div class="bcard">
      <div class="bcard-title"><span class="icon">ğŸ“¡</span> Activity Log</div>
      <div class="title-line"></div>
      <div id="event-log">
        <div class="log-entry info">System ready. Connect your Freighter wallet.</div>
      </div>
    </div>

    <div class="bcard span-2" style="grid-column:1/3">
      <div class="bcard-title"><span class="icon">ğŸ”¬</span> How it works</div>
      <div class="title-line"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">1. Setup</strong> â€” The streamer configures the number of participants, prize, and winners before the draw begins.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">2. Commit</strong> â€” A secret is hashed locally (<code>SHA-256(secret || salt)</code>) and committed on-chain via Soroban. The secret never leaves the browser.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">3. Register</strong> â€” Participant wallets are added on-chain. Manipulation is impossible because the secret was already committed.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">4. Reveal</strong> â€” The contract verifies <code>SHA-256(secret || salt) == commitment</code> and computes <code>winner = secret % participants</code>. A Noir circuit produces a formal proof for public auditing.</div></div>
      </div>
    </div>


<script src="app.js"></script>
</body>
</html>
