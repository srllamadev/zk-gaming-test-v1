<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZK Roulette â€” Stellar Hackathon 2026</title>
  <script src="https://cdn.jsdelivr.net/npm/@stellar/stellar-sdk@13/dist/stellar-sdk.min.js"></script>
  <style>
    /* â”€â”€ Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --red:        #cf2762;
      --pink:       #f4a3b2;
      --cream:      #f1e3d8;
      --tan:        #e1b495;
      --orange:     #d98046;
      --red-dark:   #a01e4c;
      --red-light:  #e85585;
      --bg:         #1a0912;
      --bg-card:    #220d18;
      --bg-bento:   #2a1020;
      --border:     #4a1530;
      --text:       #f1e3d8;
      --text-muted: #b07a88;
      --glow-red:   rgba(207,39,98, 0.4);
      --glow-orange:rgba(217,128,70, 0.35);
      --glow-pink:  rgba(244,163,178,0.25);
      --font:       'Segoe UI', system-ui, -apple-system, sans-serif;
      --mono:       'Fira Code','Courier New', monospace;
      --r:          14px;
      --r-lg:       22px;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    body::before {
      content: '';
      position: fixed;
      top: -30%; left: -20%;
      width: 65%; height: 65%;
      background: radial-gradient(ellipse, rgba(207,39,98,.08) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }
    body::after {
      content: '';
      position: fixed;
      bottom: -25%; right: -15%;
      width: 55%; height: 55%;
      background: radial-gradient(ellipse, rgba(217,128,70,.07) 0%, transparent 70%);
      pointer-events: none; z-index: 0;
    }

    #app {
      position: relative; z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px 60px;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0 28px;
      gap: 16px;
      flex-wrap: wrap;
    }
    .logo { display: flex; align-items: center; gap: 14px; }
    .logo-icon {
      width: 50px; height: 50px;
      background: linear-gradient(135deg, var(--red), var(--orange));
      border-radius: 16px;
      display: grid; place-items: center;
      font-size: 26px;
      box-shadow: 0 0 28px var(--glow-red);
      flex-shrink: 0;
    }
    .logo-text h1 {
      font-size: 1.55rem; font-weight: 800;
      background: linear-gradient(90deg, var(--pink), var(--cream), var(--tan));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; line-height: 1.1;
    }
    .logo-text p {
      font-size: .74rem; color: var(--text-muted);
      letter-spacing: .09em; text-transform: uppercase;
    }
    .header-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

    .badge {
      display: inline-flex; align-items: center; gap: 6px;
      font-size: .72rem; color: var(--text-muted);
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 50px; padding: 5px 14px;
    }
    .dot-live { width: 6px; height: 6px; border-radius: 50%; background: #10b981; box-shadow: 0 0 5px #10b981; }

    #wallet-btn {
      display: flex; align-items: center; gap: 9px;
      padding: 9px 20px;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 50px; color: var(--text);
      cursor: pointer; font-size: .88rem; font-family: var(--font);
      transition: all .25s;
    }
    #wallet-btn:hover { border-color: var(--red); box-shadow: 0 0 18px var(--glow-red); }
    #wallet-btn.connected { border-color: #10b981; box-shadow: 0 0 14px rgba(16,185,129,.25); }
    .wallet-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); transition: background .3s; }
    .wallet-dot.on { background: #10b981; box-shadow: 0 0 7px #10b981; }

    /* â”€â”€ Phase bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .phase-bar {
      display: flex; align-items: center;
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: 50px; padding: 5px; margin-bottom: 28px; overflow-x: auto;
    }
    .phase-step {
      flex: 1; text-align: center; padding: 8px 10px; border-radius: 50px;
      font-size: .74rem; font-weight: 700; color: var(--text-muted);
      letter-spacing: .05em; text-transform: uppercase; transition: all .3s;
      white-space: nowrap;
    }
    .phase-step.active {
      background: linear-gradient(135deg, var(--red), var(--orange));
      color: #fff; box-shadow: 0 0 18px var(--glow-red);
    }
    .phase-step.done { color: var(--tan); }

    /* â”€â”€ Bento grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bento {
      display: grid;
      grid-template-columns: 1fr 1fr 340px;
      grid-template-rows: auto;
      gap: 16px;
    }
    @media (max-width: 900px) { .bento { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 600px) { .bento { grid-template-columns: 1fr; } }

    .bcard {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 22px;
      position: relative; overflow: hidden;
    }
    .bcard::before {
      content: '';
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(207,39,98,.04) 0%, transparent 60%);
      pointer-events: none;
    }
    .bcard-title {
      font-size: .85rem; font-weight: 700;
      color: var(--pink); text-transform: uppercase;
      letter-spacing: .08em; margin-bottom: 16px;
      display: flex; align-items: center; gap: 8px;
    }
    .bcard-title .icon { font-size: 1rem; }

    /* span classes */
    .span-2 { grid-column: span 2; }
    .span-row-2 { grid-row: span 2; }

    /* â”€â”€ Roulette tile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .roulette-wrap { display: flex; flex-direction: column; align-items: center; gap: 20px; }
    .roulette-outer {
      position: relative; width: 240px; height: 240px;
    }
    .roulette-outer::before {
      content: ''; position: absolute; inset: -10px; border-radius: 50%;
      background: conic-gradient(var(--red), var(--orange), var(--pink), var(--red), var(--orange));
      animation: spin-glow 5s linear infinite; opacity: .55; filter: blur(10px);
    }
    .roulette-outer::after {
      content: ''; position: absolute; inset: -2px; border-radius: 50%;
      background: conic-gradient(var(--red), var(--orange), var(--pink), var(--red));
      animation: spin-glow 5s linear infinite;
    }
    #roulette-canvas { position: relative; z-index: 2; border-radius: 50%; display: block; }
    .roulette-pointer {
      position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
      z-index: 10; font-size: 26px;
      filter: drop-shadow(0 0 8px var(--orange));
      animation: ptr-bounce 1s ease-in-out infinite alternate;
    }
    @keyframes ptr-bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-4px); } }
    @keyframes spin-glow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 11px 22px; border: none; border-radius: 50px;
      font-family: var(--font); font-size: .88rem; font-weight: 700;
      cursor: pointer; transition: all .2s;
      text-transform: uppercase; letter-spacing: .05em; width: 100%;
    }
    .btn:disabled { opacity: .38; cursor: not-allowed; }
    .btn-primary {
      background: linear-gradient(135deg, var(--red), var(--orange));
      color: #fff; box-shadow: 0 4px 22px var(--glow-red);
    }
    .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 30px var(--glow-red); }
    .btn-ghost {
      background: var(--bg-bento); border: 1px solid var(--border); color: var(--text);
    }
    .btn-ghost:hover:not(:disabled) { border-color: var(--red); box-shadow: 0 0 14px var(--glow-red); }
    .btn-gold {
      background: linear-gradient(135deg, var(--red-dark), var(--red), var(--orange));
      color: #fff; font-size: .95rem; padding: 15px;
      box-shadow: 0 4px 26px var(--glow-red);
    }
    .btn-gold:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 36px var(--glow-orange); }
    .btn-sm { padding: 8px 16px; font-size: .78rem; width: auto; }

    /* â”€â”€ Inputs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-group { margin-bottom: 14px; }
    label {
      display: block; font-size: .75rem; color: var(--text-muted);
      margin-bottom: 5px; text-transform: uppercase; letter-spacing: .07em;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      background: var(--bg-bento); border: 1px solid var(--border);
      border-radius: var(--r); padding: 10px 14px;
      color: var(--text); font-family: var(--mono); font-size: .86rem;
      outline: none; transition: border .2s;
    }
    input:focus { border-color: var(--red); box-shadow: 0 0 0 3px rgba(207,39,98,.15); }

    /* â”€â”€ Stats ribbon â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
      margin-bottom: 20px;
    }
    @media (max-width: 600px) { .stats-row { grid-template-columns: repeat(2, 1fr); } }
    .stat {
      background: var(--bg-card); border: 1px solid var(--border);
      border-radius: var(--r); padding: 14px 12px; text-align: center;
    }
    .stat-val {
      font-size: 1.5rem; font-weight: 800;
      background: linear-gradient(135deg, var(--pink), var(--tan));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .stat-lbl { font-size: .7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: .07em; margin-top: 2px; }

    /* â”€â”€ Participants grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #participants-grid {
      display: flex; flex-direction: column; gap: 8px;
      max-height: 300px; overflow-y: auto;
      scrollbar-width: thin; scrollbar-color: var(--border) transparent;
    }
    .p-card {
      display: flex; align-items: center; gap: 12px;
      padding: 10px 14px;
      background: var(--bg-bento); border: 1px solid var(--border);
      border-radius: var(--r); font-size: .82rem; font-family: var(--mono);
      transition: all .2s; animation: slide-in .3s ease;
    }
    .p-card.winner {
      border-color: var(--orange); background: rgba(217,128,70,.1);
      box-shadow: 0 0 22px var(--glow-orange);
    }
    .p-avatar {
      width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0;
      background: linear-gradient(135deg, var(--red), var(--orange));
      display: grid; place-items: center; font-size: .78rem; font-weight: 700; color: #fff;
    }
    .p-addr { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text-muted); }
    .p-badge {
      font-size: .68rem; padding: 2px 8px; border-radius: 50px;
      background: rgba(217,128,70,.2); color: var(--orange); font-weight: 700;
    }

    /* â”€â”€ Wallet input row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wallet-row { display: flex; gap: 8px; margin-bottom: 10px; }
    .wallet-row input { flex: 1; }
    .wallet-row .btn { width: auto; padding: 10px 18px; font-size: .78rem; }

    /* â”€â”€ ZK data box â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .zk-box { background: var(--bg-bento); border: 1px solid var(--border); border-radius: var(--r); padding: 14px; }
    .zk-row { display: flex; align-items: flex-start; gap: 10px; padding: 7px 0; border-bottom: 1px solid var(--border); font-size: .8rem; }
    .zk-row:last-child { border-bottom: none; }
    .zk-lbl { color: var(--text-muted); width: 100px; flex-shrink: 0; }
    .zk-val { font-family: var(--mono); color: var(--pink); word-break: break-all; font-size: .75rem; }
    .zk-val.ok   { color: var(--tan); }
    .zk-val.warn { color: var(--orange); }
    .zk-val.dim  { color: var(--text-muted); font-style: italic; }

    /* â”€â”€ Activity log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #event-log { max-height: 160px; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
    .log-entry {
      font-family: var(--mono); font-size: .73rem;
      padding: 5px 10px; border-radius: 6px;
      border-left: 3px solid var(--border); line-height: 1.4;
      animation: slide-in .2s ease;
    }
    .log-entry.info  { border-color: var(--pink);   color: var(--pink); }
    .log-entry.ok    { border-color: var(--tan);    color: var(--tan); }
    .log-entry.warn  { border-color: var(--orange); color: var(--orange); }
    .log-entry.error { border-color: #ef4444; color: #fca5a5; }

    /* â”€â”€ Setup cards (pre-commit flow) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .setup-flow { display: flex; flex-direction: column; gap: 14px; }
    .step-card {
      background: var(--bg-bento); border: 1px solid var(--border);
      border-radius: var(--r); padding: 18px;
      transition: border-color .3s, box-shadow .3s;
    }
    .step-card.active-step { border-color: var(--red); box-shadow: 0 0 20px var(--glow-red); }
    .step-card.done-step   { border-color: var(--tan); opacity: .7; }
    .step-num {
      display: inline-flex; align-items: center; justify-content: center;
      width: 26px; height: 26px; border-radius: 50%;
      background: linear-gradient(135deg, var(--red), var(--orange));
      color: #fff; font-size: .78rem; font-weight: 800;
      margin-right: 10px; flex-shrink: 0;
    }
    .step-header { display: flex; align-items: center; margin-bottom: 12px; font-weight: 700; font-size: .92rem; }
    .step-header .icon { margin-right: 8px; }

    /* â”€â”€ How-it-works steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .how-step { display: flex; gap: 12px; margin-bottom: 12px; font-size: .81rem; }
    .how-step:last-child { margin-bottom: 0; }
    .how-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--red); flex-shrink: 0; margin-top: 5px; }

    /* â”€â”€ Winner overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #winner-overlay {
      display: none; position: fixed; inset: 0; z-index: 200;
      background: rgba(20,4,14,.92); backdrop-filter: blur(14px);
      align-items: center; justify-content: center;
    }
    #winner-overlay.show { display: flex; }
    .w-card {
      background: var(--bg-card); border: 2px solid var(--orange);
      border-radius: 28px; padding: 44px 36px; text-align: center;
      max-width: 460px; width: 90%;
      box-shadow: 0 0 80px var(--glow-orange), 0 0 200px rgba(217,128,70,.12);
      animation: pop .5s cubic-bezier(.175,.885,.32,1.275);
    }
    @keyframes pop { from { transform: scale(.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .w-trophy { font-size: 3.5rem; margin-bottom: 14px; }
    .w-title {
      font-size: 1.7rem; font-weight: 900;
      background: linear-gradient(90deg, var(--pink), var(--tan), var(--orange));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin-bottom: 8px;
    }
    .w-sub { color: var(--text-muted); margin-bottom: 22px; font-size: .85rem; }
    .w-addr {
      font-family: var(--mono); font-size: .8rem; color: var(--pink);
      background: var(--bg-bento); border: 1px solid var(--border);
      border-radius: var(--r); padding: 12px 14px;
      word-break: break-all; margin-bottom: 10px;
    }
    .w-prize {
      font-size: 1.1rem; font-weight: 800; color: var(--orange);
      margin-bottom: 20px;
    }
    .w-badge {
      display: inline-block; background: rgba(217,128,70,.18); color: var(--orange);
      font-weight: 700; padding: 4px 16px; border-radius: 50px;
      font-size: .82rem; margin-bottom: 24px;
    }

    /* â”€â”€ Progress indicator for wallet entry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .wallet-progress {
      display: flex; align-items: center; gap: 8px;
      font-size: .78rem; color: var(--text-muted);
      margin-bottom: 12px;
    }
    .wallet-progress-bar {
      flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden;
    }
    .wallet-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--red), var(--orange));
      border-radius: 2px;
      transition: width .4s ease;
    }

    /* â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .divider { height: 1px; background: var(--border); margin: 16px 0; }
    .text-muted { color: var(--text-muted); font-size: .82rem; }
    .spinner {
      display: inline-block; width: 14px; height: 14px;
      border: 2px solid rgba(255,255,255,.2); border-top-color: #fff;
      border-radius: 50%; animation: spin .7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slide-in { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }

    code { font-family: var(--mono); font-size: .85em; color: var(--pink); }

    /* â”€â”€ Accent divider line under bcard-title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .title-line { width: 32px; height: 3px; background: linear-gradient(90deg, var(--red), var(--orange)); border-radius: 2px; margin-bottom: 16px; }
  </style>
</head>
<body>

<!-- Winner overlay -->
<div id="winner-overlay">
  <div class="w-card">
    <div class="w-trophy">ğŸ†</div>
    <div class="w-title">Winner!</div>
    <div class="w-sub">Draw verified with ZK Proof Â· Stellar Protocol 25</div>
    <div id="w-addr" class="w-addr">â€”</div>
    <div id="w-prize" class="w-prize"></div>
    <div id="w-badge" class="w-badge">Entry #â€”</div>
    <button class="btn btn-ghost" style="margin-top:12px" onclick="closeWinnerOverlay()">Close</button>
  </div>
</div>

<div id="app">

  <!-- Header -->
  <header>
    <div class="logo">
      <div class="logo-icon">ğŸ°</div>
      <div class="logo-text">
        <h1>ZK Roulette</h1>
        <p>Provable Randomness Â· Stellar Hackathon 2026</p>
      </div>
    </div>
    <div class="header-right">
      <div class="badge"><div class="dot-live"></div> Testnet</div>
      <button id="wallet-btn" onclick="connectWallet()">
        <div class="wallet-dot" id="wallet-dot"></div>
        <span id="wallet-label">Connect Freighter</span>
      </button>
    </div>
  </header>

  <!-- Phase bar -->
  <div class="phase-bar">
    <div class="phase-step active" id="phase-0">â‘  Setup</div>
    <div class="phase-step" id="phase-1">â‘¡ Commit</div>
    <div class="phase-step" id="phase-2">â‘¢ Register</div>
    <div class="phase-step" id="phase-3">â‘£ Close</div>
    <div class="phase-step" id="phase-4">â‘¤ Reveal</div>
  </div>

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat">
      <div class="stat-val" id="stat-participants">0</div>
      <div class="stat-lbl">Participants</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-winners">â€”</div>
      <div class="stat-lbl">Winners</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-prize">â€”</div>
      <div class="stat-lbl">Prize (XLM)</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="stat-phase">SETUP</div>
      <div class="stat-lbl">Phase</div>
    </div>
  </div>

  <!-- â”€â”€ Bento grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="bento">

    <!-- 1. Setup flow card (col 1+2 top) -->
    <div class="bcard span-2" id="bcard-setup">
      <div class="bcard-title"><span class="icon">âš™ï¸</span> Draw Setup</div>
      <div class="title-line"></div>

      <div class="setup-flow">
        <!-- Step A: participants count -->
        <div class="step-card active-step" id="step-a">
          <div class="step-header">
            <span class="step-num">1</span>
            <span class="icon">ğŸ‘¥</span> Number of Participants
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>How many people will enter the draw?</label>
              <input type="number" id="input-participants-count" placeholder="e.g. 10" min="2" max="500" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmParticipantsCount()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>

        <!-- Step B: prize amount -->
        <div class="step-card" id="step-b" style="opacity:.45;pointer-events:none">
          <div class="step-header">
            <span class="step-num">2</span>
            <span class="icon">ğŸ’°</span> Prize Amount
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>Total XLM to distribute among winners</label>
              <input type="number" id="input-prize-amount" placeholder="e.g. 100" min="0.0000001" step="any" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmPrize()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>

        <!-- Step C: winners count -->
        <div class="step-card" id="step-c" style="opacity:.45;pointer-events:none">
          <div class="step-header">
            <span class="step-num">3</span>
            <span class="icon">ğŸ†</span> Number of Winners
          </div>
          <div style="display:flex;gap:10px;align-items:flex-end">
            <div class="input-group" style="flex:1;margin-bottom:0">
              <label>How many winners?</label>
              <input type="number" id="input-winners-count" placeholder="e.g. 1" min="1" max="50" />
            </div>
            <button class="btn btn-primary btn-sm" onclick="confirmWinners()" style="padding:10px 20px;width:auto;margin-bottom:1px">
              Confirm â†’
            </button>
          </div>
        </div>
      </div><!-- /setup-flow -->
    </div><!-- /setup card -->

    <!-- 2. Wallet entry card (col 1+2, replaces setup after confirmed) -->
    <div class="bcard span-2" id="bcard-wallets" style="display:none">
      <div class="bcard-title"><span class="icon">ğŸŸï¸</span> Participant Wallets</div>
      <div class="title-line"></div>

      <div class="wallet-progress">
        <span id="wallet-progress-label">0 / <span id="wallet-total-label">0</span> registered</span>
        <div class="wallet-progress-bar">
          <div class="wallet-progress-fill" id="wallet-progress-fill" style="width:0%"></div>
        </div>
      </div>

      <!-- Wallet input row -->
      <div id="wallet-inputs-section">
        <div class="wallet-row">
          <input type="text" id="input-participant" placeholder="G... Stellar address" />
          <button class="btn btn-primary" onclick="doRegister()" style="width:auto;padding:10px 20px">
            <span id="btn-register-spinner"></span> Add
          </button>
        </div>
        <p class="text-muted" style="margin-bottom:12px;font-size:.76rem">
          Enter each participant's Stellar wallet address (G..., 56 chars).
        </p>
      </div>

      <!-- List -->
      <div id="participants-grid">
        <p class="text-muted" style="text-align:center;padding:16px 0">No participants yet.</p>
      </div>

      <div class="divider"></div>

      <!-- Commit + Close actions -->
      <div id="wallet-actions" style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-primary" id="btn-commit-main" onclick="doCommit()" style="flex:1">
          <span id="btn-commit-spinner"></span> ğŸ”’ Publish Commitment
        </button>
        <button class="btn btn-ghost" id="btn-close-main" onclick="doCloseRegistrations()" style="flex:1" disabled>
          <span id="btn-close-spinner"></span> ğŸ” Close Registrations
        </button>
      </div>
    </div><!-- /wallets card -->

    <!-- 3. Roulette (right col â€” spans 2 rows) -->
    <div class="bcard span-row-2" style="grid-column:3;grid-row:1/3;display:flex;flex-direction:column;align-items:center;gap:20px;justify-content:center">
      <div class="bcard-title" style="width:100%"><span class="icon">ğŸ¡</span> Wheel</div>
      <div class="roulette-wrap">
        <div class="roulette-outer">
          <div class="roulette-pointer">â–¼</div>
          <canvas id="roulette-canvas" width="240" height="240"></canvas>
        </div>
        <button id="spin-btn" class="btn btn-gold" onclick="spinRoulette()" disabled>
          ğŸ° Spin &amp; Reveal
        </button>
      </div>

      <!-- Session ID (needed for commit) -->
      <div style="width:100%">
        <div class="input-group" style="margin-bottom:8px">
          <label>Session ID</label>
          <input type="number" id="input-session-id" placeholder="e.g. 1001" min="1" max="999999" />
        </div>
      </div>
    </div>

    <!-- 4. ZK Data -->
    <div class="bcard">
      <div class="bcard-title"><span class="icon">ğŸ§®</span> ZK Commit-Reveal</div>
      <div class="title-line"></div>
      <div class="zk-box">
        <div class="zk-row"><span class="zk-lbl">Secret</span><span class="zk-val dim" id="zk-secret">hidden</span></div>
        <div class="zk-row"><span class="zk-lbl">Salt</span><span class="zk-val dim" id="zk-salt">hidden</span></div>
        <div class="zk-row"><span class="zk-lbl">Commitment</span><span class="zk-val dim" id="zk-commitment">â€”</span></div>
        <div class="zk-row"><span class="zk-lbl">On-chain</span><span class="zk-val dim" id="zk-onchain">pending</span></div>
        <div class="zk-row"><span class="zk-lbl">Entries</span><span class="zk-val dim" id="zk-participants">0</span></div>
        <div class="zk-row"><span class="zk-lbl">winner_index</span><span class="zk-val dim" id="zk-winner">â€”</span></div>
        <div class="zk-row"><span class="zk-lbl">Noir Proof</span><span class="zk-val dim" id="zk-proof-status">pending</span></div>
      </div>
      <div style="margin-top:10px">
        <a id="noir-proof-link" href="#" style="display:none;font-size:.75rem;color:var(--pink)">View proof JSON â†’</a>
      </div>
    </div>

    <!-- 5. Activity log -->
    <div class="bcard">
      <div class="bcard-title"><span class="icon">ğŸ“¡</span> Activity Log</div>
      <div class="title-line"></div>
      <div id="event-log">
        <div class="log-entry info">System ready. Connect your Freighter wallet.</div>
      </div>
    </div>

    <!-- 6. How it works (bottom, spans full) -->
    <div class="bcard span-2" style="grid-column:1/3">
      <div class="bcard-title"><span class="icon">ğŸ”¬</span> How it works</div>
      <div class="title-line"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">1. Setup</strong> â€” The streamer configures the number of participants, prize, and winners before the draw begins.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">2. Commit</strong> â€” A secret is hashed locally (<code>SHA-256(secret || salt)</code>) and committed on-chain via Soroban. The secret never leaves the browser.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">3. Register</strong> â€” Participant wallets are added on-chain. Manipulation is impossible because the secret was already committed.</div></div>
        <div class="how-step"><div class="how-dot"></div><div style="color:var(--text-muted);line-height:1.6"><strong style="color:var(--cream)">4. Reveal</strong> â€” The contract verifies <code>SHA-256(secret || salt) == commitment</code> and computes <code>winner = secret % participants</code>. A Noir circuit produces a formal proof for public auditing.</div></div>
      </div>
    </div>

  </div><!-- /bento -->
</div><!-- /app -->

<script type="module">
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  CONFIG â€” Update CONTRACT_ID after running scripts/deploy.sh
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CONFIG = {
  CONTRACT_ID:        "REPLACE_WITH_YOUR_CONTRACT_ID",
  GAME_HUB:           "CB4VZAT2U3UC6XFK3N23SKRF2NDCMP3QHJYMCHHFMZO7MRQO6DQ2EMYG",
  NETWORK:            "TESTNET",
  NETWORK_PASSPHRASE: "Test SDF Network ; September 2015",
  SOROBAN_RPC:        "https://soroban-testnet.stellar.org",
  HORIZON_URL:        "https://horizon-testnet.stellar.org",
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  GLOBAL STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const state = {
  phase:             "SETUP",   // SETUP | IDLE | COMMITTED | OPEN | CLOSED | REVEALED
  publicKey:         null,
  sessionId:         null,
  secretNumber:      null,       // BigInt
  salt:              null,       // Uint8Array(32)
  commitment:        null,       // Uint8Array(32)
  participants:      [],
  participantsTarget: null,      // number â€” set in setup step A
  prizeAmount:       null,       // number (XLM)
  winnersCount:      null,       // number
  winners:           [],         // array of { index, address }
  noirProof:         null,
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ROULETTE CANVAS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SEGMENTS = [
  "#cf2762","#d98046","#e1b495","#f4a3b2",
  "#a01e4c","#b05c30","#e85585","#c87a50",
  "#d03060","#be7040","#f0809a","#d29060",
];

const rCanvas = document.getElementById("roulette-canvas");
const rCtx    = rCanvas.getContext("2d");
let rAngle    = 0;
let rSpinning = false;

function drawWheel(list, hi = -1) {
  const cx = 120, cy = 120, rad = 116;
  const n  = Math.max(list.length, 1);
  rCtx.clearRect(0, 0, 240, 240);
  rCtx.save();
  rCtx.translate(cx, cy);
  rCtx.rotate(rAngle);

  const step = (Math.PI * 2) / n;
  for (let i = 0; i < n; i++) {
    const s = step * i - Math.PI / 2;
    const e = s + step;
    rCtx.beginPath();
    rCtx.moveTo(0, 0);
    rCtx.arc(0, 0, rad, s, e);
    rCtx.closePath();
    rCtx.fillStyle = i === hi ? "#f1e3d8" : SEGMENTS[i % SEGMENTS.length] + "cc";
    rCtx.fill();
    rCtx.strokeStyle = "rgba(255,255,255,.06)";
    rCtx.lineWidth = 1.5;
    rCtx.stroke();
    if (n > 1) {
      const mid = s + step / 2;
      rCtx.fillStyle = "rgba(255,255,255,.9)";
      rCtx.font = `bold ${n > 14 ? 9 : 12}px sans-serif`;
      rCtx.textAlign = "center";
      rCtx.textBaseline = "middle";
      rCtx.fillText(i + 1, Math.cos(mid) * rad * .6, Math.sin(mid) * rad * .6);
    }
  }
  // Center hub
  rCtx.beginPath();
  rCtx.arc(0, 0, 20, 0, Math.PI * 2);
  const g = rCtx.createRadialGradient(0,0,3,0,0,20);
  g.addColorStop(0, "#f1e3d8");
  g.addColorStop(1, "#cf2762");
  rCtx.fillStyle = g;
  rCtx.fill();
  rCtx.restore();
}
drawWheel([]);

function animateSpin(target, dur, done) {
  rSpinning = true;
  const start = rAngle, t0 = performance.now();
  function frame(now) {
    const t    = Math.min((now - t0) / dur, 1);
    const ease = 1 - Math.pow(1 - t, 5);
    rAngle = start + (target - start) * ease;
    drawWheel(state.participants);
    if (t < 1) requestAnimationFrame(frame);
    else { rSpinning = false; done && done(); }
  }
  requestAnimationFrame(frame);
}

// Idle slow spin
setInterval(() => {
  if (!rSpinning && state.phase !== "REVEALED") {
    rAngle += 0.003;
    drawWheel(state.participants, state.winners[0]?.index ?? -1);
  }
}, 30);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ACTIVITY LOG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function log(msg, type = "info") {
  const el  = document.getElementById("event-log");
  const div = document.createElement("div");
  div.className = `log-entry ${type}`;
  const ts = new Date().toLocaleTimeString("en", { hour12: false });
  div.textContent = `[${ts}] ${msg}`;
  el.appendChild(div);
  el.scrollTop = el.scrollHeight;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  UI UPDATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updatePhaseUI() {
  const map = { SETUP:0, IDLE:1, COMMITTED:1, OPEN:2, CLOSED:3, REVEALED:4 };
  const idx = map[state.phase] ?? 0;
  for (let i = 0; i < 5; i++) {
    const el = document.getElementById(`phase-${i}`);
    el.className = "phase-step" + (i === idx ? " active" : i < idx ? " done" : "");
  }
  document.getElementById("stat-phase").textContent        = state.phase;
  document.getElementById("stat-participants").textContent = state.participants.length;
  document.getElementById("stat-winners").textContent      = state.winnersCount ?? "â€”";
  document.getElementById("stat-prize").textContent        = state.prizeAmount ?? "â€”";
  document.getElementById("zk-participants").textContent   = state.participants.length;

  document.getElementById("spin-btn").disabled = state.phase !== "CLOSED";

  // Show/hide main sections
  const setupCard   = document.getElementById("bcard-setup");
  const walletCard  = document.getElementById("bcard-wallets");

  if (state.phase === "SETUP") {
    setupCard.style.display  = "";
    walletCard.style.display = "none";
  } else {
    setupCard.style.display  = "none";
    walletCard.style.display = "";
  }

  // Commit / Close buttons
  const btnCommit = document.getElementById("btn-commit-main");
  const btnClose  = document.getElementById("btn-close-main");
  if (btnCommit) {
    btnCommit.disabled = state.phase !== "IDLE" && state.phase !== "OPEN";
    if (state.phase === "COMMITTED" || state.phase === "OPEN") {
      btnCommit.disabled = true;
    }
  }
  if (btnClose) {
    btnClose.disabled = state.phase !== "OPEN" || state.participants.length < 2;
  }

  // Wallet input: hide once closed
  const walletInputSection = document.getElementById("wallet-inputs-section");
  if (walletInputSection) {
    walletInputSection.style.display = (state.phase === "CLOSED" || state.phase === "REVEALED") ? "none" : "";
  }

  // Wallet progress bar
  updateWalletProgress();

  renderParticipants();
}

function updateWalletProgress() {
  const total   = state.participantsTarget ?? 0;
  const current = state.participants.length;
  const pct     = total > 0 ? Math.min((current / total) * 100, 100) : 0;
  const fill  = document.getElementById("wallet-progress-fill");
  const label = document.getElementById("wallet-progress-label");
  const tot   = document.getElementById("wallet-total-label");
  if (fill)  fill.style.width = pct + "%";
  if (label) label.innerHTML  = `${current} / <span id="wallet-total-label">${total}</span> registered`;
  if (tot)   tot.textContent  = total;
}

function renderParticipants(winnerIndexes = []) {
  const grid = document.getElementById("participants-grid");
  if (state.participants.length === 0) {
    grid.innerHTML = '<p class="text-muted" style="text-align:center;padding:14px 0">No participants yet.</p>';
    return;
  }
  grid.innerHTML = state.participants.map((addr, i) => {
    const isWinner = winnerIndexes.includes(i);
    return `<div class="p-card ${isWinner ? "winner" : ""}">
      <div class="p-avatar">${i + 1}</div>
      <div class="p-addr">${addr}</div>
      ${isWinner ? '<div class="p-badge">ğŸ† WINNER</div>' : ""}
    </div>`;
  }).join("");
}

function setZk(id, val, cls = "") {
  const el = document.getElementById(id);
  el.textContent = val;
  el.className   = `zk-val ${cls}`.trim();
}

function shortHex(bytes) {
  const h = Array.from(bytes).map(b => b.toString(16).padStart(2, "0")).join("");
  return h.slice(0,8) + "â€¦" + h.slice(-8);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  SETUP STEPS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.confirmParticipantsCount = function () {
  const val = parseInt(document.getElementById("input-participants-count").value, 10);
  if (!val || val < 2) { alert("Enter at least 2 participants"); return; }
  state.participantsTarget = val;

  // Mark step A done, activate step B
  document.getElementById("step-a").className = "step-card done-step";
  const stepB = document.getElementById("step-b");
  stepB.style.opacity      = "1";
  stepB.style.pointerEvents = "auto";
  stepB.className           = "step-card active-step";
  log(`Participants set: ${val}`, "ok");
};

window.confirmPrize = function () {
  const val = parseFloat(document.getElementById("input-prize-amount").value);
  if (!val || val <= 0) { alert("Enter a valid prize amount (XLM > 0)"); return; }
  state.prizeAmount = val;

  document.getElementById("step-b").className = "step-card done-step";
  const stepC = document.getElementById("step-c");
  stepC.style.opacity       = "1";
  stepC.style.pointerEvents = "auto";
  stepC.className            = "step-card active-step";
  log(`Prize set: ${val} XLM`, "ok");
};

window.confirmWinners = function () {
  const val = parseInt(document.getElementById("input-winners-count").value, 10);
  if (!val || val < 1) { alert("Enter at least 1 winner"); return; }
  if (val >= state.participantsTarget) { alert("Winners must be less than total participants"); return; }
  state.winnersCount = val;

  document.getElementById("step-c").className = "step-card done-step";
  log(`Winners set: ${val}`, "ok");
  log(`Setup complete! Now enter participant wallets.`, "ok");

  // Transition to wallet entry phase
  state.phase = "IDLE";
  updatePhaseUI();
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  FREIGHTER WALLET
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getFreighter() {
  if (window.freighterApi) return window.freighterApi;
  throw new Error("Freighter not found. Install the extension at: https://freighter.app");
}

window.connectWallet = async function () {
  try {
    const freighter = getFreighter();
    const { publicKey } = await freighter.requestAccess();
    if (!publicKey) throw new Error("Access denied by user");
    state.publicKey = publicKey;
    const short = `${publicKey.slice(0,6)}â€¦${publicKey.slice(-4)}`;
    document.getElementById("wallet-dot").classList.add("on");
    document.getElementById("wallet-label").textContent = short;
    document.getElementById("wallet-btn").classList.add("connected");
    log(`Wallet connected: ${publicKey}`, "ok");
  } catch (err) {
    log(`Wallet error: ${err.message}`, "error");
    alert("Error: " + err.message);
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  LOCAL CRYPTO (Web Crypto API)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function randomBytes(n) { return crypto.getRandomValues(new Uint8Array(n)); }

async function computeCommitment(secretNumber, salt) {
  const pre  = new Uint8Array(40);
  const view = new DataView(pre.buffer);
  view.setBigUint64(0, BigInt(secretNumber), false);
  pre.set(salt, 8);
  return new Uint8Array(await crypto.subtle.digest("SHA-256", pre));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  SOROBAN RPC
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getSdk() {
  if (!window.StellarSdk) throw new Error("stellar-sdk not loaded");
  return window.StellarSdk;
}
function getRpc() { return new (getSdk()).SorobanRpc.Server(CONFIG.SOROBAN_RPC, { allowHttp: false }); }

async function invokeContract(method, args = []) {
  if (!state.publicKey) throw new Error("Wallet not connected");
  const Sdk = getSdk(), server = getRpc(), freighter = getFreighter();
  const account = await server.getAccount(state.publicKey);
  const tx = new Sdk.TransactionBuilder(account, { fee: "200000", networkPassphrase: CONFIG.NETWORK_PASSPHRASE })
    .addOperation(new Sdk.Contract(CONFIG.CONTRACT_ID).call(method, ...args))
    .setTimeout(30).build();
  const sim = await server.simulateTransaction(tx);
  if (Sdk.SorobanRpc.Api.isSimulationError(sim)) throw new Error(`Simulation failed: ${sim.error}`);
  const prep     = Sdk.SorobanRpc.assembleTransaction(tx, sim).build();
  const signedXdr = await freighter.signTransaction(prep.toXDR(), { networkPassphrase: CONFIG.NETWORK_PASSPHRASE });
  const signedTx  = Sdk.TransactionBuilder.fromXDR(signedXdr, CONFIG.NETWORK_PASSPHRASE);
  const send = await server.sendTransaction(signedTx);
  if (send.status === "ERROR") throw new Error(`Submit failed: ${JSON.stringify(send.errorResult)}`);
  for (let i = 0; i < 30; i++) {
    await new Promise(r => setTimeout(r, 2000));
    const res = await server.getTransaction(send.hash);
    if (res.status === "SUCCESS") return res;
    if (res.status === "FAILED")  throw new Error("Transaction failed on-chain");
  }
  throw new Error("Timeout waiting for confirmation");
}

// ScVal helpers
function scAddr(a)    { return new (getSdk()).Address(a).toScVal(); }
function scU32(n)     { return getSdk().xdr.ScVal.scvU32(n >>> 0); }
function scU64(n)     { const Sdk=getSdk(),b=BigInt(n); return Sdk.xdr.ScVal.scvU64(new Sdk.xdr.Uint64(Number(b&0xFFFFFFFFn)>>>0,Number(b>>32n)>>>0)); }
function scBytes(b)   { return getSdk().xdr.ScVal.scvBytes(Buffer.from(b)); }

// Spinner helpers
function showSpin(id) { const e=document.getElementById(id); if(e) e.innerHTML='<span class="spinner"></span>&nbsp;'; }
function hideSpin(id) { const e=document.getElementById(id); if(e) e.innerHTML=''; }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ACTION 1 â€” COMMIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doCommit = async function () {
  if (!state.publicKey) { alert("Connect your wallet first"); return; }
  const sid = parseInt(document.getElementById("input-session-id").value.trim(), 10);
  if (!sid || isNaN(sid)) { alert("Enter a valid Session ID in the wheel panel"); return; }

  try {
    showSpin("btn-commit-spinner");
    log("Generating secret number and salt locally...", "info");

    const secretBytes = randomBytes(8);
    let secret = new DataView(secretBytes.buffer).getBigUint64(0, false);
    if (secret === 0n) secret = 1n;
    const salt = randomBytes(32);
    const commitment = await computeCommitment(secret, salt);

    state.secretNumber = secret;
    state.salt         = salt;
    state.commitment   = commitment;
    state.sessionId    = sid;

    setZk("zk-secret",     "****" + secret.toString().slice(-4) + " (hidden)", "warn");
    setZk("zk-salt",       shortHex(salt) + " (local)", "warn");
    setZk("zk-commitment", shortHex(commitment), "ok");

    log(`Commitment computed: ${shortHex(commitment)}`, "ok");
    log("Sending commitment to Soroban...", "info");

    await invokeContract("commit_draw", [scAddr(state.publicKey), scU32(sid), scBytes(commitment)]);

    setZk("zk-onchain", "âœ“ confirmed on Testnet", "ok");
    log(`commit_draw(${sid}) confirmed âœ“`, "ok");

    localStorage.setItem(`zk_${sid}`, JSON.stringify({
      sessionId: sid,
      secretNumber: secret.toString(),
      salt: Array.from(salt),
      commitment: Array.from(commitment),
    }));

    state.phase = "OPEN";
    updatePhaseUI();

  } catch (err) {
    log(`Commit error: ${err.message}`, "error");
    alert("Error: " + err.message);
  } finally {
    hideSpin("btn-commit-spinner");
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ACTION 2 â€” REGISTER PARTICIPANT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doRegister = async function () {
  if (!state.publicKey) { alert("Connect your wallet first"); return; }
  if (state.phase === "IDLE") { alert("Publish commitment first (ğŸ”’ button)"); return; }

  const addr = document.getElementById("input-participant").value.trim();
  if (!addr || !addr.startsWith("G") || addr.length < 56) {
    alert("Enter a valid Stellar address (G..., 56 chars)"); return;
  }
  if (state.participants.includes(addr)) {
    alert("That participant is already registered"); return;
  }
  if (state.participantsTarget && state.participants.length >= state.participantsTarget) {
    alert(`Maximum participants reached (${state.participantsTarget})`); return;
  }

  try {
    showSpin("btn-register-spinner");
    log(`Registering ${addr.slice(0,10)}â€¦`, "info");

    await invokeContract("register_participant", [scU32(state.sessionId), scAddr(addr)]);

    state.participants.push(addr);
    document.getElementById("input-participant").value = "";
    drawWheel(state.participants);
    updatePhaseUI();
    log(`âœ“ ${addr.slice(0,10)}â€¦ registered (#${state.participants.length})`, "ok");

    // Auto-show close button hint when target reached
    if (state.participantsTarget && state.participants.length >= state.participantsTarget) {
      log(`All ${state.participantsTarget} participants registered! Close registrations.`, "warn");
    }
  } catch (err) {
    log(`Register error: ${err.message}`, "error");
    alert("Error: " + err.message);
  } finally {
    hideSpin("btn-register-spinner");
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ACTION 3 â€” CLOSE REGISTRATIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doCloseRegistrations = async function () {
  if (state.participants.length < 2) { alert("Need at least 2 participants"); return; }
  try {
    showSpin("btn-close-spinner");
    log("Closing registrationsâ€¦", "info");
    await invokeContract("close_registrations", [scU32(state.sessionId)]);
    state.phase = "CLOSED";
    updatePhaseUI();
    log("Registrations closed. Participant list is frozen on-chain âœ“", "ok");
    log(`Winner formula: secret % ${state.participants.length}`, "info");
  } catch (err) {
    log(`Close error: ${err.message}`, "error");
    alert("Error: " + err.message);
  } finally {
    hideSpin("btn-close-spinner");
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  SPIN BUTTON
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.spinRoulette = function () { if (!rSpinning) doReveal(); };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ACTION 4 â€” REVEAL WINNER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.doReveal = async function () {
  if (!state.secretNumber || !state.salt) {
    const stored = localStorage.getItem(`zk_${state.sessionId}`);
    if (stored) {
      const d = JSON.parse(stored);
      state.secretNumber = BigInt(d.secretNumber);
      state.salt         = new Uint8Array(d.salt);
      state.commitment   = new Uint8Array(d.commitment);
      log("Secret recovered from local storage", "warn");
    } else {
      alert("Local secret not found. Did you reload without saving?");
      return;
    }
  }
  const n = state.participants.length;
  if (n < 2) { alert("Not enough participants"); return; }

  try {
    showSpin("btn-reveal-spinner");
    document.getElementById("spin-btn").disabled = true;

    log("Generating ZK proof with Noir circuitâ€¦", "info");
    setZk("zk-proof-status", "generatingâ€¦", "warn");
    drawWheel(state.participants);

    const winnerIndex = Number(state.secretNumber % BigInt(n));

    const noirProof = await simulateNoirProof(state.secretNumber, state.salt, n, winnerIndex);
    state.noirProof = noirProof;
    setZk("zk-proof-status", "âœ“ proof generated (JSON)", "ok");

    const blob = new Blob([JSON.stringify(noirProof, null, 2)], { type: "application/json" });
    const link = document.getElementById("noir-proof-link");
    link.href = URL.createObjectURL(blob);
    link.download = `zk_proof_${state.sessionId}.json`;
    link.style.display = "block";

    log(`Noir proof: winner_index=${winnerIndex} (${state.secretNumber} % ${n})`, "ok");

    // Spin animation
    log("Spinning the wheelâ€¦", "info");
    const seg    = (Math.PI * 2) / n;
    const target = rAngle + (Math.floor(Math.random() * 4) + 6) * Math.PI * 2
                           + Math.PI * 2 - (seg * winnerIndex + seg / 2);
    await new Promise(r => animateSpin(target, 5500, r));
    drawWheel(state.participants, winnerIndex);

    // On-chain reveal
    log("Sending reveal_winner to Sorobanâ€¦", "info");
    await invokeContract("reveal_winner", [scU32(state.sessionId), scU64(state.secretNumber), scBytes(state.salt)]);

    state.winnerIndex   = winnerIndex;
    state.winnerAddress = state.participants[winnerIndex];
    state.winners       = [{ index: winnerIndex, address: state.winnerAddress }];
    state.phase         = "REVEALED";

    setZk("zk-winner", `#${winnerIndex} (${state.winnerAddress?.slice(0,10)}â€¦)`, "ok");
    setZk("zk-secret", state.secretNumber.toString(), "ok");
    setZk("zk-salt",   shortHex(state.salt), "ok");

    log(`reveal_winner confirmed on-chain âœ“`, "ok");
    log(`ğŸ† Winner: #${winnerIndex + 1} â€” ${state.winnerAddress}`, "ok");

    localStorage.removeItem(`zk_${state.sessionId}`);
    renderParticipants([winnerIndex]);
    updatePhaseUI();
    showWinnerOverlay(winnerIndex, state.winnerAddress);

  } catch (err) {
    log(`Reveal error: ${err.message}`, "error");
    alert("Error: " + err.message);
    document.getElementById("spin-btn").disabled = false;
  } finally {
    hideSpin("btn-reveal-spinner");
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  NOIR PROOF SIMULATION
//  In production replace with real @noir-lang/noir_js call
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function simulateNoirProof(secret, salt, n, winnerIdx) {
  await new Promise(r => setTimeout(r, 1600 + Math.random() * 1200));
  const commitment = await computeCommitment(secret, salt);
  return {
    _note: "Simulated proof for demo. Replace with noir_js in production.",
    circuit: "zk_roulette", backend: "barretenberg/UltraPlonk",
    public_inputs: {
      public_commitment: "0x" + Array.from(commitment).map(b=>b.toString(16).padStart(2,"0")).join(""),
      number_of_participants: n, winner_index: winnerIdx,
    },
    proof_bytes: "0x" + Array.from(randomBytes(32)).map(b=>b.toString(16).padStart(2,"0")).join("") + "â€¦",
    verified: true, timestamp: new Date().toISOString(),
  };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  WINNER OVERLAY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showWinnerOverlay(index, address) {
  const perWinner = state.prizeAmount && state.winnersCount
    ? (state.prizeAmount / state.winnersCount).toFixed(7)
    : null;
  document.getElementById("w-addr").textContent  = address || "â€”";
  document.getElementById("w-prize").textContent = perWinner ? `Prize: ${perWinner} XLM` : "";
  document.getElementById("w-badge").textContent = `Entry #${index + 1}`;
  document.getElementById("winner-overlay").classList.add("show");
}
window.closeWinnerOverlay = () => document.getElementById("winner-overlay").classList.remove("show");

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function init() {
  updatePhaseUI();
  drawWheel([]);

  if (!window.freighterApi) {
    log("Freighter not detected. Install at: https://freighter.app", "warn");
  } else {
    window.freighterApi.isConnected().then(({ isConnected }) => {
      if (!isConnected) return;
      window.freighterApi.getPublicKey().then(key => {
        if (!key) return;
        state.publicKey = key;
        document.getElementById("wallet-dot").classList.add("on");
        document.getElementById("wallet-label").textContent = `${key.slice(0,6)}â€¦${key.slice(-4)}`;
        document.getElementById("wallet-btn").classList.add("connected");
        log(`Wallet auto-connected: ${key}`, "ok");
      }).catch(() => {});
    }).catch(() => {});
  }

  log("ZK Roulette v1.0 ready Â· Stellar Testnet Â· Protocol 25", "ok");
}());
</script>
</body>
</html>
